<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Relatório de Assistência Técnica - Nordeste Serviços</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 8pt;
            color: #000;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 8.5in;
            min-height: 11in;
            margin: 10px auto;
            background-color: #fff;
            padding: 25px;
            border: 1px solid #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            page-break-inside: avoid; /* Evita que tabelas quebrem no meio da página */
        }
        td, th {
            border: 1px solid #ccc;
            padding: 4px 6px;
            text-align: left;
            vertical-align: top;
        }
        .no-border, .no-border td, .no-border th {
            border: none;
        }
        .header-table td {
            vertical-align: top;
        }
        .header-table .logo-container {
            background-color: #1E88E5; /* Cor azul */
            padding: 10px;
            display: inline-block;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .header-table .logo {
            width: 150px; /* Tamanho aumentado */
            height: auto;
            display: block;
        }
        .header-table .company-info {
            font-size: 8.5pt;
        }
        .header-table .company-info p {
            margin: 2px 0;
        }
        .header-table .os-title-block {
            border: 1px solid #000;
            text-align: center;
            padding: 5px;
            margin-bottom: 5px;
        }
        .header-table .os-title-block h1 {
            font-size: 11pt;
            margin: 0 0 5px 0;
            font-weight: 700;
        }
        .header-table .os-title-block p {
            font-size: 14pt;
            font-weight: 700;
            margin: 0;
        }
        .header-table .os-details-table td {
            font-size: 7.5pt;
            border: none;
            padding: 1px 3px;
        }
        .label {
            font-weight: 700;
        }
        .section-header td, .section-header th {
            background-color: #E3F2FD;
            color: #0d47a1;
            font-weight: 700;
            font-size: 9pt;
            padding: 5px 6px;
            border-color: #a9d6ff;
        }
        .info-grid td {
            font-size: 8.5pt;
        }
        .service-content td {
            padding: 8px;
            font-size: 8.5pt;
        }
        .data-table thead th {
            background-color: #1565C0;
            color: white;
            font-weight: 700;
            font-size: 8.5pt;
            padding: 5px 6px;
        }
        .photo-grid {
            text-align: center;
        }
        .photo-grid td {
            width: 33.33%;
            vertical-align: top;
            padding: 5px;
        }
        .photo-grid img {
            max-width: 100%;
            border: 1px solid #999;
            margin-bottom: 4px;
        }
        .photo-grid p {
            font-size: 7.5pt;
            margin: 0;
        }
    </style>
</head>
<body>

<div class="container">
    <table class="no-border header-table">
        <tr>
            <td style="width: 50%;">
                <div class="logo-container">
                    <img class="logo" src="https://github.com/LKaio16/nordeste-servicos-api/blob/main/src/main/resources/static/logo.png?raw=true" alt="DCDN Logo" />
                </div>
                <div class="company-info">
                    <p><strong>NORDESTE SERVIÇOS</strong></p>
                    <p>RODOVIA BR.116, 10.001, KM 50, ENDEREÇO</p>
                    <p>FORTALEZA - CEP: 601.843-325-CE</p>
                    <p>Tel: (85) 99600-9422</p>
                </div>
            </td>
            <td style="width: 50%;">
                <div class="os-title-block">
                    <h1>ORDEM DE SERVIÇOS</h1>
                    <p th:text="${os.numeroOS ?: 'N/A'}">OS-1</p>
                </div>
                <table class="os-details-table">
                    <tr><td><span class="label">Status OS:</span></td> <td th:text="${os.status?.name() ?: 'N/A'}">EM_ABERTO</td></tr>
                    <tr><td><span class="label">Data de Abertura:</span></td> <td th:text="${os.dataAbertura != null ? #temporals.format(os.dataAbertura, 'dd/MM/yyyy') : 'N/A'}">12/06/2025</td></tr>
                    <tr><td><span class="label">Data de Fechamento:</span></td> <td th:text="${os.dataFechamento != null ? #temporals.format(os.dataFechamento, 'dd/MM/yyyy') : 'N/A'}">N/A</td></tr>
                    <tr><td><span class="label">Data/Hora Emissão:</span></td> <td th:text="${os.dataHoraEmissao != null ? #temporals.format(os.dataHoraEmissao, 'dd/MM/yyyy HH:mm:ss') : 'N/A'}">12/06/2025 03:59:00</td></tr>
                </table>
            </td>
        </tr>
    </table>

    <table>
        <tr class="section-header"><td colspan="4">DADOS DO TÉCNICO</td></tr>
        <tr class="info-grid">
            <td style="width: 10%;"><span class="label">Crachá:</span></td>
            <td style="width: 40%;" th:text="${os.tecnicoAtribuido?.cracha ?: 'N/A'}">27268</td>
            <td style="width: 10%;"><span class="label">Nome:</span></td>
            <td style="width: 40%;" th:text="${os.tecnicoAtribuido?.nome ?: 'N/A'}">Kaio</td>
        </tr>
    </table>

    <table>
        <tr class="section-header"><td colspan="4">DADOS DO EQUIPAMENTO</td></tr>
        <tr class="info-grid">
            <td><span class="label">Equipamento:</span></td>
            <td th:text="${os.equipamento?.marcaModelo ?: 'N/A'}">Marca XYZ - Modelo T-1000</td>
            <td><span class="label">Chassi:</span></td>
            <td th:text="${os.equipamento?.numeroSerieChassi ?: 'N/A'}">XYZ987654321</td>
        </tr>
        <tr class="info-grid">
            <td><span class="label">Horímetro:</span></td>
            <td th:text="${os.equipamento?.horimetro ?: 'N/A'}">1542.5</td>
            <td><span class="label">Propriedade:</span></td>
            <td th:text="${os.equipamento?.tipo ?: 'N/A'}">Trator</td>
        </tr>
    </table>

    <table>
        <tr class="section-header"><td colspan="4">DADOS DO CLIENTE</td></tr>
        <tr class="info-grid">
            <td><span class="label">Cliente:</span></td>
            <td colspan="3" th:text="${os.cliente?.nomeCompleto ?: 'N/A'}">Luis Kaio de Araújo</td>
        </tr>
        <tr class="info-grid">
            <td><span class="label">Email Pesquisa Satisfação:</span></td>
            <td th:text="${os.cliente?.email ?: 'N/A'}">ytkkaio16@gmail.com</td>
            <td><span class="label">Telefone:</span></td>
            <td th:text="${os.cliente?.telefonePrincipal ?: 'N/A'}">85985769887</td>
        </tr>
        <tr class="info-grid">
            <td><span class="label">Endereço:</span></td>
            <td colspan="3" th:text="${(os.cliente?.rua ?: '') + ', ' + (os.cliente?.numero ?: '')}">Jundiai, 1160</td>
        </tr>
        <tr class="info-grid">
            <td><span class="label">Bairro:</span></td>
            <td th:text="${os.cliente?.bairro ?: 'N/A'}">Messejana</td>
            <td><span class="label">Insc. Estadual:</span></td>
            <td></td>
        </tr>
        <tr class="info-grid">
            <td><span class="label">CEP:</span></td>
            <td th:text="${os.cliente?.cep ?: 'N/A'}">60871135</td>
            <td><span class="label">Cidade:</span></td>
            <td th:text="${(os.cliente?.cidade ?: '') + ' - ' + (os.cliente?.estado ?: '')}">Fortaleza CE</td>
        </tr>
    </table>

    <table>
        <tr class="section-header"><td colspan="2">RECLAMAÇÃO CLIENTE</td></tr>
        <tr class="service-content">
            <td th:text="${os.problemaRelatado ?: 'N/A'}">O equipamento está com um barulho estranho no motor.</td>
        </tr>
    </table>

    <table>
        <tr class="section-header"><td colspan="2">ANÁLISE DA FALHA / CAUSA</td></tr>
        <tr class="service-content">
            <td th:text="${os.analiseFalha ?: 'N/A'}">N/A</td>
        </tr>
    </table>

    <table>
        <tr class="section-header"><td colspan="2">SERVIÇOS REALIZADOS / SOLUÇÃO</td></tr>
        <tr class="service-content">
            <td th:text="${os.solucaoAplicada ?: 'N/A'}">N/A</td>
        </tr>
    </table>

    <div>
        <table class="data-table">
            <thead>
            <tr class="section-header"><th colspan="6">HORAS TRABALHADAS TÉCNICOS</th></tr>
            <tr>
                <th>Data</th>
                <th>Serviço</th>
                <th>Técnico</th>
                <th>Início do Trabalho</th>
                <th>Término do Trabalho</th>
                <th>Horas Trabalhadas</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="rt : ${os.registrosTempo}">
                <td th:text="${rt.data != null ? #temporals.format(rt.data, 'dd/MM/yyyy') : 'N/A'}">12/06/2025</td>
                <td th:text="${rt.descricaoTipoServico ?: 'N/A'}">Diagnóstico</td>
                <td th:text="${rt.nomeTecnico ?: 'N/A'}">Kaio</td>
                <td th:text="${rt.horaInicio != null ? #temporals.format(rt.horaInicio, 'HH:mm:ss') : 'N/A'}">09:00:00</td>
                <td th:text="${rt.horaTermino != null ? #temporals.format(rt.horaTermino, 'HH:mm:ss') : 'N/A'}">11:30:00</td>
                <td th:text="${rt.horasTrabalhadas ?: 'N/A'}">2.5</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div>
        <table class="data-table">
            <thead>
            <tr class="section-header"><th colspan="7">DESLOCAMENTO</th></tr>
            <tr>
                <th>Data</th>
                <th>Placa</th>
                <th>Saída De</th>
                <th>Km Inicial</th>
                <th>Chegada Em</th>
                <th>Km Final</th>
                <th>Total de Km</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="rd : ${os.registrosDeslocamento}">
                <td th:text="${rd.data != null ? #temporals.format(rd.data, 'dd/MM/yyyy') : 'N/A'}">12/06/2025</td>
                <td th:text="${rd.placaVeiculo ?: 'N/A'}">ABC-1234</td>
                <td th:text="${rd.saidaDe ?: 'N/A'}">Sede da Empresa</td>
                <td th:text="${rd.kmInicial ?: 'N/A'}">15000</td>
                <td th:text="${rd.chegadaEm ?: 'N/A'}">Local do Cliente</td>
                <td th:text="${rd.kmFinal ?: 'N/A'}">15025</td>
                <td th:text="${rd.totalKm ?: 'N/A'}">25</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div>
        <table class="data-table">
            <thead>
            <tr class="section-header"><th colspan="5">PEÇAS</th></tr>
            <tr>
                <th>Código</th>
                <th>Descrição</th>
                <th>Requisitada</th>
                <th>Utilizada</th>
                <th>Devolvida</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="iu : ${os.itensUtilizados}">
                <td th:text="${iu.codigoPecaMaterial ?: 'N/A'}">FIL-001</td>
                <td th:text="${iu.descricaoPecaMaterial ?: 'N/A'}">Filtro de Óleo</td>
                <td th:text="${iu.quantidadeRequisitada ?: 'N/A'}">1</td>
                <td th:text="${iu.quantidadeUtilizada ?: 'N/A'}">1</td>
                <td th:text="${iu.quantidadeDevolvida ?: 'N/A'}">0</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div>
        <table>
            <tr class="section-header"><td colspan="4">ASSINATURA</td></tr>
            <tr>
                <td><span class="label">Responsável Acomp. Serviço:</span></td>
                <td th:text="${os.assinatura?.nomeResponsavel ?: 'N/A'}"></td>
                <td><span class="label">Técnico:</span></td>
                <td th:text="${os.tecnicoAtribuido?.nome ?: 'N/A'}"></td>
            </tr>
            <tr>
                <td><span class="label">Documento:</span></td>
                <td th:text="${os.assinatura?.documentoResponsavel ?: 'N/A'}"></td>
                <td><span class="label">Data/Hora:</span></td>
                <td th:text="${os.assinatura?.dataHora != null ? #temporals.format(os.assinatura.dataHora, 'dd/MM/yyyy HH:mm:ss') : 'N/A'}"></td>
            </tr>
        </table>
    </div>

    <div>
        <table>
            <tr class="section-header"><td colspan="3">FOTOS</td></tr>
            <tbody>
            <tr class="photo-grid" th:each="i : ${#numbers.sequence(0, (os.fotos != null ? os.fotos.size() : 0) - 1, 3)}">
                <td th:if="${os.fotos != null and i < os.fotos.size()}">
                    <img th:src="${os.fotos[i].urlAcesso}" />
                    <p th:text="${os.fotos[i].nomeArquivoOriginal ?: 'Sem descrição'}"></p>
                </td>
                <td th:unless="${os.fotos != null and i < os.fotos.size()}"></td>
                <td th:if="${os.fotos != null and i + 1 < os.fotos.size()}">
                    <img th:src="${os.fotos[i+1].urlAcesso}" />
                    <p th:text="${os.fotos[i+1].nomeArquivoOriginal ?: 'Sem descrição'}"></p>
                </td>
                <td th:unless="${os.fotos != null and i + 1 < os.fotos.size()}"></td>
                <td th:if="${os.fotos != null and i + 2 < os.fotos.size()}">
                    <img th:src="${os.fotos[i+2].urlAcesso}" />
                    <p th:text="${os.fotos[i+2].nomeArquivoOriginal ?: 'Sem descrição'}"></p>
                </td>
                <td th:unless="${os.fotos != null and i + 2 < os.fotos.size()}"></td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

</body>
</html>